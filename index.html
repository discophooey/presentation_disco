<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Presentation Disco</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0a0a0a; color: #e0e0e0; min-height: 100vh; }

#loginScreen { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%); }
.login-box { background: #1a1a1a; padding: 40px; border-radius: 12px; border: 1px solid #2a2a2a; text-align: center; }
.login-box h1 { font-size: 28px; color: #4a9eff; margin-bottom: 8px; }
.login-box p { color: #666; font-size: 13px; margin-bottom: 24px; }
.login-box input { width: 250px; padding: 12px 16px; background: #0a0a0a; border: 1px solid #333; color: #fff; border-radius: 6px; font-size: 14px; text-align: center; }
.login-box input:focus { outline: none; border-color: #4a9eff; }
.login-box button { width: 250px; padding: 12px; background: #4a9eff; border: none; color: #000; font-weight: 600; border-radius: 6px; cursor: pointer; font-size: 14px; margin-top: 12px; }
.login-box button:hover { background: #357abd; }
.login-error { color: #e74c3c; font-size: 12px; margin-top: 12px; display: none; }

#hubScreen { display: none; min-height: 100vh; padding: 20px 20px; }
.hub-header { max-width: 1200px; margin: 0 auto 20px; display: flex; justify-content: space-between; align-items: center; }
.hub-header h1 { font-size: 24px; color: #4a9eff; }
.hub-header button { padding: 8px 16px; background: #2a2a2a; border: none; color: #888; border-radius: 6px; cursor: pointer; font-size: 12px; }
.hub-header button:hover { background: #333; color: #fff; }

.landing-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; max-width: 1200px; margin: 0 auto; }
.module-card { background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 8px; padding: 14px; text-decoration: none; transition: all 0.2s; display: block; position: relative; height: 90px; overflow: hidden; }
.module-card:hover { border-color: #4a9eff; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(74, 158, 255, 0.1); }
.module-card-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.module-card h3 { color: #4a9eff; font-size: 14px; margin: 0; }
.module-card p { color: #888; font-size: 11px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.module-card .status-dot { position: absolute; top: 10px; right: 10px; width: 8px; height: 8px; border-radius: 50%; display: none; }
.module-card .status-dot.orange { display: block; background: #f90; }
.module-card .status-dot.green { display: block; background: #4a4; }

.demo-btn { 
    background: #2a2a2a; 
    border: 1px solid #3a3a3a; 
    color: #888; 
    font-size: 9px; 
    padding: 3px 6px; 
    border-radius: 4px; 
    cursor: pointer; 
    font-weight: 500; 
    display: inline-flex; 
    align-items: center; 
    gap: 3px;
    transition: all 0.2s;
    text-decoration: none;
}
.demo-btn:hover { background: #3a3a3a; color: #fff; border-color: #4a4a4a; }
.demo-btn .play-icon { font-size: 7px; }

.section-title { max-width: 1200px; margin: 0 auto 12px; padding-top: 20px; border-top: 1px solid #2a2a2a; margin-top: 20px; color: #666; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
.section-title:first-of-type { border-top: none; margin-top: 0; padding-top: 0; }

/* Demo Modal */
.demo-modal { 
    display: none; 
    position: fixed; 
    inset: 0; 
    background: rgba(0,0,0,0.9); 
    z-index: 1000; 
    align-items: center; 
    justify-content: center;
    padding: 20px;
}
.demo-modal.active { display: flex; }
.demo-modal-content { 
    background: #1a1a1a; 
    border-radius: 12px; 
    width: 100%; 
    max-width: 500px; 
    max-height: 90vh;
    overflow: hidden;
    border: 1px solid #2a2a2a;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
}
.demo-modal-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 16px 20px; 
    border-bottom: 1px solid #2a2a2a;
}
.demo-modal-header h3 { color: #4a9eff; font-size: 16px; margin: 0; }
.demo-modal-close { 
    background: #2a2a2a; 
    border: none; 
    color: #888; 
    width: 32px; 
    height: 32px; 
    border-radius: 6px; 
    cursor: pointer; 
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.demo-modal-close:hover { background: #3a3a3a; color: #fff; }
.demo-modal-body { height: 400px; }
.demo-modal-body iframe { width: 100%; height: 100%; border: none; }

/* Disco Modal */
.disco-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:99999;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.2s;pointer-events:none;font-family:-apple-system,BlinkMacSystemFont,sans-serif}
.disco-modal-overlay.active{opacity:1;pointer-events:auto}
.disco-modal{background:#1e1e24;border-radius:12px;padding:24px;max-width:360px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,0.5);transform:scale(0.95);transition:transform 0.2s}
.disco-modal-overlay.active .disco-modal{transform:scale(1)}
.disco-modal-title{color:#4a9eff;font-size:14px;font-weight:600;margin-bottom:12px}
.disco-modal-msg{color:#ccc;font-size:14px;line-height:1.5;margin-bottom:20px;white-space:pre-line}
.disco-modal-btns{display:flex;gap:8px;justify-content:flex-end}
.disco-modal-btns button{padding:8px 18px;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:background 0.2s}
.disco-modal-btns .disco-btn-primary{background:#4a9eff;color:#fff}
.disco-modal-btns .disco-btn-primary:hover{background:#3a8eef}
.disco-modal-btns .disco-btn-secondary{background:#2a2a34;color:#aaa}
.disco-modal-btns .disco-btn-secondary:hover{background:#3a3a44;color:#ccc}
</style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <h1>Presentation Disco <span style="font-size: 12px; font-weight: 300; color: #666;">v211</span></h1>
        <p>Scroll-driven storytelling modules</p>
        <input type="password" id="passwordInput" placeholder="Enter password" onkeypress="if(event.key==='Enter')checkPassword()">
        <button onclick="checkPassword()">Enter</button>
        <div class="login-error" id="loginError">Incorrect password</div>
    </div>
</div>

<div id="hubScreen">
    <div class="hub-header">
        <h1>Presentation Disco <span style="font-size: 12px; font-weight: 300; color: #666;">v211</span></h1>
        <button onclick="logout()">Logout</button>
    </div>
    
    <div class="section-title">Modules</div>
    <div class="landing-grid">
        <a href="before-after.html" class="module-card" data-module="before-after"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Before/After</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('before-after-demo.html', 'Before/After')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Scroll-driven comparison slider between two images with drag and scroll modes.</p>
        </a>
        <a href="card-stack.html" class="module-card" data-module="card-stack"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Card Stack</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('card-stack-demo.html', 'Card Stack')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Stacked cards that fly away on scroll, revealing content beneath.</p>
        </a>
        <a href="chart.html" class="module-card" data-module="chart"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Chart</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('chart-demo.html', 'Chart')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Scroll-driven bar and pie charts with staggered animations.</p>
        </a>
        <a href="collage.html" class="module-card" data-module="collage"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Collage</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('collage-demo.html', 'Collage')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Multi-image grid layout with per-image positioning controls.</p>
        </a>
        <a href="doc-module.html" class="module-card" data-module="doc-module"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Doc Module</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('doc-module-demo.html', 'Doc Module')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Document image with animated highlight bars that reveal on scroll. Blend modes and aspect ratio controls.</p>
        </a>
        <a href="gallery.html" class="module-card" data-module="gallery"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Gallery</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('gallery-demo.html', 'Gallery')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Scroll-driven image sequence with transitions and text overlays.</p>
        </a>
        <a href="globe.html" class="module-card" data-module="globe"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Globe</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('globe-demo.html', 'Globe')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>3D WebGL globe with animated location markers and connection lines.</p>
        </a>
        <a href="hotspots.html" class="module-card" data-module="hotspots"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Hotspots</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('hotspots-demo.html', 'Hotspots')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Interactive annotation points that appear at scroll positions.</p>
        </a>
        <a href="layers.html" class="module-card" data-module="layers"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Layers</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('layers-demo.html', 'Layers')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Multi-layer parallax compositions with various animation effects.</p>
        </a>
        <a href="matte.html" class="module-card" data-module="matte"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Matte</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('matte-demo.html', 'Matte')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Text or image matte reveals with scroll-driven animation and background clipping.</p>
        </a>
        <a href="single-image.html" class="module-card" data-module="single-image"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Single Image</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('single-image-demo.html', 'Single Image')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Hero images with scroll-driven effects like zoom, parallax, tilt.</p>
        </a>
        <a href="stat-counter.html" class="module-card" data-module="stat-counter"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Stat Counter</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('stat-counter-demo.html', 'Stat Counter')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Animated number counters that increment on scroll.</p>
        </a>
        <a href="timeline.html" class="module-card" data-module="timeline"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Timeline</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('timeline-demo.html', 'Timeline')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Vertical timeline with events that reveal on scroll.</p>
        </a>
        <a href="video.html" class="module-card" data-module="video"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Video</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('video-demo.html', 'Video')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Scroll-controlled video playback with text overlays.</p>
        </a>
        <a href="zoom-detail.html" class="module-card" data-module="zoom-detail"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Zoom Detail</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('zoom-detail-demo.html', 'Zoom Detail')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Progressive zoom into a specific image region on scroll.</p>
        </a>
    </div>
    
    <div class="section-title">Text Modules</div>
    <div class="landing-grid">
        <a href="text-scroll.html" class="module-card" data-module="text-scroll"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Text Scroll</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('text-scroll-demo.html', 'Text Scroll')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Punchy statement blocks with crossfading background images or solid colors.</p>
        </a>
        <a href="chapter-marker.html" class="module-card" data-module="chapter-marker"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Chapter Marker</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('chapter-marker-demo.html', 'Chapter Marker')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Full-viewport section dividers with animated text reveals including random letters effect.</p>
        </a>
        <a href="key-facts.html" class="module-card" data-module="key-facts"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Key Facts Panel</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('key-facts-demo.html', 'Key Facts Panel')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Structured info box with staggered reveal animations and source attribution.</p>
        </a>
        <a href="body-module.html" class="module-card" data-module="body-module"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Body Module</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('body-module-demo.html', 'Body Module')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Traditional article text with optional floating image and fullscreen lightbox.</p>
        </a>
        <a href="pull-quote.html" class="module-card" data-module="pull-quote"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Pull Quote</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('pull-quote-demo.html', 'Pull Quote')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Large-format text display with scroll-triggered reveal animations.</p>
        </a>
    </div>

    <div class="section-title">Fact Focus Modules</div>
    <div class="landing-grid">
        <a href="epistemic-text.html" class="module-card" data-module="epistemic-text"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Epistemic Text</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('epistemic-text-demo.html', 'Epistemic Text')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Confidence-tagged article text with toggleable claim verification overlays.</p>
        </a>
        <a href="adversarial-verification.html" class="module-card" data-module="adversarial-verification"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Adversarial Verification</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('adversarial-verification-demo.html', 'Adversarial Verification')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Interactive claim challenges with expandable evidence chains and progress tracking.</p>
        </a>
        <a href="silence-mapping.html" class="module-card" data-module="silence-mapping"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Silence Mapping</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('silence-mapping-demo.html', 'Silence Mapping')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Document reporting gaps ‚Äî denied sources, pending FOIAs, and scope limitations with expandable timelines.</p>
        </a>
        <a href="multi-angle.html" class="module-card" data-module="multi-angle"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Multi-Angle Investigation</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('multi-angle-demo.html', 'Multi-Angle Investigation')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Compare multiple sources side-by-side with annotated media, lightbox viewer, and source attribution.</p>
        </a>
        <a href="clock-narrative.html" class="module-card" data-module="clock-narrative"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Clock Narrative</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('clock-narrative-demo.html', 'Clock Narrative')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Chronological event timeline with animated clock face, time-synced entries, and scroll-driven playback.</p>
        </a>
        <a href="claim-evidence.html" class="module-card" data-module="claim-evidence"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Claim vs Evidence</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('claim-evidence-demo.html', 'Claim vs Evidence')"><span class="play-icon">‚ñ∂</span> demo</button>
            </div>
            <p>Side-by-side claim vs. evidence comparison with split-panel layout and navigable entry dots.</p>
        </a>
    </div>
    
    <div class="section-title">Tools</div>
    <div class="landing-grid">
        <a href="stack-builder-clean.html" class="module-card"><h3>Stack Builder</h3><p>Combine multiple module exports into a single seamless scroll story.</p></a>
        <a href="story-planner.html" class="module-card"><h3>Presentation Planner</h3><p>Plan your scroll presentation structure, assign modules, and export content to modules.</p></a>
        <a href="coordinate-finder.html" class="module-card"><h3>Coordinate Finder</h3><p>Click a map to get lat/long coordinates for the Globe module.</p></a>
        <a href="responsive-preview.html" class="module-card"><h3>Responsive Preview</h3><p>Test module code at different screen sizes before embedding.</p></a>
        <a href="image-sequence.html" class="module-card"><h3>Asset Exporter</h3><p>Export scroll stories as PNG frames for Resolve, Premiere, After Effects.</p></a>
    </div>
    
    <div class="section-title">Session</div>
    <div style="display:flex;gap:12px;flex-wrap:wrap;max-width:1200px;margin:0 auto;justify-content:space-between;align-items:center;">
        <div style="display:flex;gap:12px;">
            <button onclick="saveSession()" style="padding:12px 24px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:8px;color:#e0e0e0;cursor:pointer;font-size:14px;">Save Session</button>
            <button onclick="document.getElementById('loadSessionInput').click()" style="padding:12px 24px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:8px;color:#e0e0e0;cursor:pointer;font-size:14px;">Load Session</button>
            <button onclick="clearAllData()" style="padding:12px 24px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:8px;color:#e0e0e0;cursor:pointer;font-size:14px;">Clear All</button>
            <input type="file" id="loadSessionInput" accept=".json" onchange="loadSession(event)" style="display:none;">
        </div>
        <button onclick="openWorkFolder()" style="padding:12px 24px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:8px;color:#e0e0e0;cursor:pointer;font-size:14px;">üìÅ Work Folder</button>
    </div>
</div>

<!-- Save Session Modal -->
<div id="saveModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:10000;align-items:center;justify-content:center;">
    <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:30px;max-width:400px;width:90%;">
        <h3 style="color:#fff;margin-bottom:16px;">Save Session</h3>
        <input type="text" id="sessionName" placeholder="Session name" style="width:100%;padding:12px;background:#0f0f0f;border:1px solid #2a2a2a;border-radius:6px;color:#e0e0e0;font-size:14px;margin-bottom:16px;">
        <div style="display:flex;gap:10px;justify-content:flex-end;">
            <button onclick="closeSaveModal()" style="padding:10px 20px;background:#2a2a2a;border:none;border-radius:6px;color:#e0e0e0;cursor:pointer;">Cancel</button>
            <button onclick="confirmSaveSession()" style="padding:10px 20px;background:#4a9eff;border:none;border-radius:6px;color:#000;font-weight:600;cursor:pointer;">Save</button>
        </div>
    </div>
</div>

<!-- Demo Modal -->
<div class="demo-modal" id="demoModal">
    <div class="demo-modal-content">
        <div class="demo-modal-header">
            <h3 id="demoTitle">Demo</h3>
            <button class="demo-modal-close" onclick="closeDemo()">‚úï</button>
        </div>
        <div class="demo-modal-body">
            <iframe id="demoIframe" src=""></iframe>
        </div>
    </div>
</div>

<script>
const PASS_HASH = '44c7be8469ab4904ff80ba58bdcf860c';

function md5(s){function L(k,d){return(k<<d)|(k>>>(32-d))}function K(G,k){var I,d,F,H,x;F=(G&2147483648);H=(k&2147483648);I=(G&1073741824);d=(k&1073741824);x=(G&1073741823)+(k&1073741823);if(I&d){return(x^2147483648^F^H)}if(I|d){if(x&1073741824){return(x^3221225472^F^H)}else{return(x^1073741824^F^H)}}else{return(x^F^H)}}function r(d,F,k){return(d&F)|((~d)&k)}function q(d,F,k){return(d&k)|(F&(~k))}function p(d,F,k){return(d^F^k)}function n(d,F,k){return(F^(d|(~k)))}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F)}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F)}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F)}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F)}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-(x%64))/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;var H=0;while(H<F){Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=(aa[Z]|(G.charCodeAt(H)<<d));H++}Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=aa[Z]|(128<<d);aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa}function B(x){var k="",F="",G,d;for(d=0;d<=3;d++){G=(x>>>(d*8))&255;F="0"+G.toString(16);k=k+F.substr(F.length-2,2)}return k}function J(k){k=k.replace(/\r\n/g,"\n");var d="";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128){d+=String.fromCharCode(x)}else{if((x>127)&&(x<2048)){d+=String.fromCharCode((x>>6)|192);d+=String.fromCharCode((x&63)|128)}else{d+=String.fromCharCode((x>>12)|224);d+=String.fromCharCode(((x>>6)&63)|128);d+=String.fromCharCode((x&63)|128)}}}return d}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g)}return(B(Y)+B(X)+B(W)+B(V)).toLowerCase()}

function checkPassword() {
    const input = document.getElementById('passwordInput').value;
    if (md5(input) === PASS_HASH) {
        sessionStorage.setItem('disco_auth', '1');
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('hubScreen').style.display = 'block';
    } else {
        document.getElementById('loginError').style.display = 'block';
        document.getElementById('passwordInput').value = '';
    }
}

function logout() {
    discoConfirm('Log out and clear all saved module data?\n\nThis will reset all modules to defaults.', function(){// Clear all disco_ localStorage keys
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith('disco_')) {
                localStorage.removeItem(key);
            }
        });
        sessionStorage.removeItem('disco_auth');
        location.reload();});
}

function openDemo(demoFile, title) {
    document.getElementById('demoTitle').textContent = title + ' Demo';
    document.getElementById('demoIframe').src = 'demos/' + demoFile;
    document.getElementById('demoModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeDemo() {
    document.getElementById('demoModal').classList.remove('active');
    document.getElementById('demoIframe').src = '';
    document.body.style.overflow = '';
}

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closeDemo();
});

// Close modal on backdrop click
document.getElementById('demoModal').addEventListener('click', function(e) {
    if (e.target === this) closeDemo();
});

if (sessionStorage.getItem('disco_auth') === '1') {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('hubScreen').style.display = 'block';
}

// Update status dots for modules with saved content
document.querySelectorAll('.module-card[data-module]').forEach(function(card) {
    var mod = card.getAttribute('data-module');
    var key = 'disco_' + mod;
    var dot = card.querySelector('.status-dot');
    if (!dot) return;
    var hasContent = localStorage.getItem(key);
    var fromPlanner = localStorage.getItem(key + '_from_planner');
    if (hasContent) {
        if (fromPlanner === 'true') {
            dot.className = 'status-dot orange';
        } else {
            dot.className = 'status-dot green';
        }
    }
});

document.getElementById('passwordInput').focus();

// Session management
function saveSession() {
    document.getElementById('saveModal').style.display = 'flex';
    document.getElementById('sessionName').value = '';
    document.getElementById('sessionName').focus();
}

function closeSaveModal() {
    document.getElementById('saveModal').style.display = 'none';
}

function confirmSaveSession() {
    var name = document.getElementById('sessionName').value.trim();
    if (!name) {
        discoAlert('Please enter a session name');
        return;
    }
    
    // Collect all scrolltastic localStorage keys
    var sessionData = {};
    for (var i = 0; i < localStorage.length; i++) {
        var key = localStorage.key(i);
        if (key && (key.startsWith('disco_') || key.startsWith('scrolltastic_') || key.startsWith('stack_'))) {
            sessionData[key] = localStorage.getItem(key);
        }
    }
    
    // Add metadata
    sessionData._meta = {
        name: name,
        date: new Date().toISOString(),
        version: 'v118'
    };
    
    // Download as JSON
    var blob = new Blob([JSON.stringify(sessionData, null, 2)], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = name.replace(/[^a-z0-9]/gi, '_') + '_session.json';
    a.click();
    URL.revokeObjectURL(url);
    
    closeSaveModal();
}

function loadSession(event) {
    var file = event.target.files[0];
    if (!file) return;
    
    var reader = new FileReader();
    reader.onload = function(e) {
        try {
            var sessionData = JSON.parse(e.target.result);
            var meta = sessionData._meta || {};
            
            // Confirm restore
            var msg = 'Load session';
            if (meta.name) msg += ' "' + meta.name + '"';
            if (meta.date) msg += ' from ' + new Date(meta.date).toLocaleDateString();
            msg += '?\n\nThis will replace your current session data.';
            
            discoConfirm(msg, null, function(){event.target.value = '';
                return;});
            
            // Clear existing scrolltastic data
            var keysToRemove = [];
            for (var i = 0; i < localStorage.length; i++) {
                var key = localStorage.key(i);
                if (key && (key.startsWith('disco_') || key.startsWith('scrolltastic_') || key.startsWith('stack_'))) {
                    keysToRemove.push(key);
                }
            }
            keysToRemove.forEach(function(key) {
                localStorage.removeItem(key);
            });
            
            // Restore session data
            var count = 0;
            for (var key in sessionData) {
                if (key !== '_meta') {
                    localStorage.setItem(key, sessionData[key]);
                    count++;
                }
            }
            
            discoAlert('Session loaded! Restored ' + count + ' items.\n\nRefreshing page...');
            location.reload();
            
        } catch (err) {
            discoAlert('Error loading session: ' + err.message);
        }
    };
    reader.readAsText(file);
    event.target.value = '';
}

function clearAllData() {
    var keysToRemove = [];
    for (var i = 0; i < localStorage.length; i++) {
        var key = localStorage.key(i);
        if (key && (key.startsWith('disco_') || key.startsWith('scrolltastic_') || key.startsWith('stack_'))) {
            keysToRemove.push(key);
        }
    }
    
    if (keysToRemove.length === 0) {
        discoAlert('No session data to clear.');
        return;
    }
    
    discoConfirm('Clear all session data?\n\nThis will remove ' + keysToRemove.length + ' saved items and cannot be undone.', function() {
    keysToRemove.forEach(function(key) {
        localStorage.removeItem(key);
    });
    
    discoAlert('Cleared ' + keysToRemove.length + ' items.\n\nRefreshing page...');
    location.reload();
});
}

function openWorkFolder() {
    window.open('asset-bin.html', 'WorkFolder', 'width=800,height=600,menubar=no,toolbar=no,location=no,status=no');
}

// Allow Enter key in save modal
document.getElementById('sessionName').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') confirmSaveSession();
    if (e.key === 'Escape') closeSaveModal();
});
</script>

<div class="disco-modal-overlay" id="discoModalOverlay" onclick="if(event.target===this)discoCloseModal()"><div class="disco-modal"><div class="disco-modal-title">Disco says:</div><div class="disco-modal-msg" id="discoModalMsg"></div><div class="disco-modal-btns" id="discoModalBtns"></div></div></div>
<script>
function discoAlert(msg,cb){var o=document.getElementById('discoModalOverlay'),m=document.getElementById('discoModalMsg'),b=document.getElementById('discoModalBtns');m.textContent=typeof msg==='string'?msg:String(msg);b.innerHTML='<button class="disco-btn-primary" onclick="discoCloseModal(\'ok\')">OK</button>';o.classList.add('active');window._discoCb=cb||null;window._discoOk=null;window._discoCancel=null;}
function discoConfirm(msg,onOk,onCancel){var o=document.getElementById('discoModalOverlay'),m=document.getElementById('discoModalMsg'),b=document.getElementById('discoModalBtns');m.textContent=typeof msg==='string'?msg:String(msg);b.innerHTML='<button class="disco-btn-secondary" onclick="discoCloseModal(\'cancel\')">Cancel</button><button class="disco-btn-primary" onclick="discoCloseModal(\'ok\')">OK</button>';o.classList.add('active');window._discoOk=onOk||null;window._discoCancel=onCancel||null;window._discoCb=null;}
function discoStackSend(){var o=document.getElementById('discoModalOverlay'),m=document.getElementById('discoModalMsg'),b=document.getElementById('discoModalBtns');m.textContent='Sent to Stack Builder!';b.innerHTML='<button class="disco-btn-secondary" onclick="discoCloseModal(\'cancel\')">Close</button><button class="disco-btn-primary" onclick="discoCloseModal(\'ok\')">Open Stack Builder now</button>';o.classList.add('active');window._discoOk=function(){window.location.href='stack-builder-clean.html';};window._discoCancel=null;window._discoCb=null;}
function discoCloseModal(action){document.getElementById('discoModalOverlay').classList.remove('active');if(action==='ok'&&window._discoOk){var f=window._discoOk;window._discoOk=null;f();}else if(action==='cancel'&&window._discoCancel){var f=window._discoCancel;window._discoCancel=null;f();}else if(action==='ok'&&window._discoCb){var f=window._discoCb;window._discoCb=null;f();}}
</script>
</body>
</html>
