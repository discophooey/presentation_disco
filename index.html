<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Presentation Disco</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=JetBrains+Mono:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap');
:root {
    --bg-deep: #0a0a0a;
    --bg-primary: #111111;
    --bg-secondary: #1a1a1a;
    --bg-tertiary: #242424;
    --border: #2e2e2e;
    --border-light: #3d3d3d;
    --text-primary: #e0e0e0;
    --text-secondary: #888888;
    --text-dim: #5a5a5a;
    --accent: #4a9eff;
    --accent-dim: #2a6db8;
    --accent-glow: rgba(74,158,255,0.12);
    --mono: 'JetBrains Mono', monospace;
    --sans: 'DM Sans', sans-serif;
    --display: 'Instrument Serif', serif;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: var(--sans); background: var(--bg-deep); color: var(--text-primary); min-height: 100vh; }
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: var(--bg-deep); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 6px; }

#loginScreen { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: var(--bg-deep); }
.login-box { background: var(--bg-secondary); padding: 44px; border-radius: 12px; border: 1px solid var(--border); text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
.login-box h1 { font-family: var(--display); font-size: 30px; font-weight: 400; color: var(--text-primary); margin-bottom: 6px; letter-spacing: -0.01em; }
.login-box h1 span { color: var(--text-dim) !important; font-family: var(--mono) !important; }
.login-box p { font-family: var(--mono); color: var(--text-dim); font-size: 10px; margin-bottom: 28px; text-transform: uppercase; letter-spacing: 1.5px; }
.login-box input { width: 260px; padding: 10px 14px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 6px; font-family: var(--mono); font-size: 12px; text-align: center; outline: none; transition: border-color .15s; }
.login-box input:focus { border-color: var(--accent-dim); }
.login-box button { width: 260px; padding: 10px; background: var(--accent); border: 1px solid var(--accent); color: #0a0a0a; font-family: var(--mono); font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-radius: 6px; cursor: pointer; margin-top: 12px; transition: opacity .15s; }
.login-box button:hover { opacity: 0.85; }
.login-error { font-family: var(--mono); color: #e74c3c; font-size: 10px; margin-top: 12px; display: none; }

#hubScreen { display: none; min-height: 100vh; padding: 20px 20px; }
.hub-header { max-width: 1200px; margin: 0 auto 20px; display: flex; justify-content: space-between; align-items: center; }
.hub-header h1 { font-family: var(--display); font-size: 24px; font-weight: 400; color: var(--text-primary); letter-spacing: -0.01em; }
.hub-header h1 span { color: var(--text-dim) !important; font-family: var(--mono) !important; }
.hub-header > div > button { padding: 7px 14px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-secondary); border-radius: 6px; cursor: pointer; font-family: var(--mono); font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; transition: all .15s; }
.hub-header > div > button:hover { border-color: var(--accent-dim); color: var(--accent); }

.landing-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; max-width: 1200px; margin: 0 auto; }
.module-card { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 14px; text-decoration: none; transition: all 0.15s; display: block; position: relative; height: 90px; overflow: hidden; }
.module-card:hover { border-color: var(--accent-dim); transform: translateY(-1px); box-shadow: 0 6px 16px var(--accent-glow); }
.module-card-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.module-card h3 { font-family: var(--mono); color: var(--accent); font-size: 12px; font-weight: 500; margin: 0; letter-spacing: 0.3px; }
.module-card p { font-family: var(--sans); color: var(--text-dim); font-size: 11px; line-height: 1.45; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.module-card .status-dot { position: absolute; top: 10px; right: 10px; width: 7px; height: 7px; border-radius: 50%; display: none; }
.module-card .status-dot.orange { display: block; background: #f90; box-shadow: 0 0 6px rgba(255,153,0,0.3); }
.module-card .status-dot.green { display: block; background: #4a4; box-shadow: 0 0 6px rgba(68,170,68,0.3); }

.demo-btn {
    background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-dim);
    font-family: var(--mono); font-size: 8px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;
    padding: 3px 7px; border-radius: 4px; cursor: pointer;
    display: inline-flex; align-items: center; gap: 3px; transition: all 0.15s; text-decoration: none;
}
.demo-btn:hover { border-color: var(--accent-dim); color: var(--accent); }
.demo-btn .play-icon { font-size: 7px; }

.section-title { max-width: 1200px; margin: 0 auto 10px; padding-top: 18px; border-top: 1px solid var(--border); margin-top: 18px; font-family: var(--mono); color: var(--text-dim); font-size: 9px; text-transform: uppercase; letter-spacing: 1.5px; }
.section-title:first-of-type { border-top: none; margin-top: 0; padding-top: 0; }

/* Demo Modal */
.demo-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
.demo-modal.active { display: flex; }
.demo-modal-content { background: var(--bg-secondary); border-radius: 12px; width: 100%; max-width: 500px; max-height: 90vh; overflow: hidden; border: 1px solid var(--border-light); box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
.demo-modal-header { display: flex; justify-content: space-between; align-items: center; padding: 14px 18px; border-bottom: 1px solid var(--border); }
.demo-modal-header h3 { font-family: var(--mono); color: var(--accent); font-size: 11px; font-weight: 500; margin: 0; text-transform: uppercase; letter-spacing: 1.5px; }
.demo-modal-close { background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-dim); width: 28px; height: 28px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; transition: all .15s; }
.demo-modal-close:hover { border-color: var(--accent-dim); color: var(--accent); }
.demo-modal-body { height: 400px; }
.demo-modal-body iframe { width: 100%; height: 100%; border: none; }

/* Disco Modal */
.disco-modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 99999; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.2s; pointer-events: none; font-family: var(--sans); }
.disco-modal-overlay.active { display: flex; opacity: 1; pointer-events: auto; }
.disco-modal { background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: 12px; padding: 24px; max-width: 360px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.5); transform: scale(0.95); transition: transform 0.2s; }
.disco-modal-overlay.active .disco-modal { transform: scale(1); }
.disco-modal-title { font-family: var(--mono); font-size: 10px; font-weight: 600; color: var(--accent); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 12px; }
.disco-modal-msg { color: var(--text-secondary); font-size: 13px; line-height: 1.5; margin-bottom: 20px; white-space: pre-line; }
.disco-modal-btns { display: flex; gap: 8px; justify-content: flex-end; }
.disco-modal-btns button { padding: 7px 16px; border: none; border-radius: 6px; font-family: var(--mono); font-size: 10px; font-weight: 500; cursor: pointer; transition: all 0.15s; text-transform: uppercase; letter-spacing: 0.5px; }
.disco-modal-btns .disco-btn-primary { background: var(--accent); color: #0a0a0a; font-weight: 600; border: 1px solid var(--accent); }
.disco-modal-btns .disco-btn-primary:hover { opacity: 0.85; }
.disco-modal-btns .disco-btn-secondary { background: var(--bg-tertiary); color: var(--text-dim); border: 1px solid var(--border); }
.disco-modal-btns .disco-btn-secondary:hover { border-color: var(--border-light); color: var(--text-secondary); }

/* Mode Toggle */
.mode-toggle { display: flex; background: var(--bg-secondary); border-radius: 6px; border: 1px solid var(--border); overflow: hidden; }
.mode-toggle button { padding: 7px 14px; background: none; border: none; color: var(--text-dim); font-family: var(--mono); font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; transition: all 0.15s; white-space: nowrap; }
.mode-toggle button.active { background: var(--accent); color: #0a0a0a; font-weight: 600; }
.mode-toggle button:hover:not(.active) { color: var(--text-secondary); }

/* Presentation Mode Layout */
#presentationMode { display: none; max-width: 100%; height: calc(100vh - 80px); }
#presentationMode.active { display: flex; gap: 0; }

/* Module Palette (left) */
.pm-palette { width: 230px; min-width: 230px; background: var(--bg-primary); border-right: 1px solid var(--border); display: flex; flex-direction: column; height: 100%; }
.pm-palette-header { padding: 14px 16px; border-bottom: 1px solid var(--border); background: var(--bg-secondary); }
.pm-palette-header h3 { font-family: var(--mono); color: var(--text-dim); font-size: 9px; text-transform: uppercase; letter-spacing: 2px; }
.pm-palette-list { flex: 1; overflow-y: auto; padding: 10px; }
.pm-palette-cat { font-family: var(--mono); color: var(--accent-dim); font-size: 8px; text-transform: uppercase; letter-spacing: 1.5px; padding: 12px 6px 6px; margin-top: 2px; border-top: 1px solid var(--border); }
.pm-palette-cat:first-child { border-top: none; margin-top: 0; padding-top: 6px; }
.pm-palette-item { padding: 7px 10px; background: transparent; border: 1px solid transparent; border-radius: 5px; margin-bottom: 2px; cursor: grab; transition: all 0.15s; user-select: none; }
.pm-palette-item:hover { border-color: var(--border); background: var(--bg-secondary); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
.pm-palette-item:active { cursor: grabbing; border-color: var(--accent-dim); }
.pm-palette-item .pm-mod-name { font-family: var(--mono); color: var(--text-secondary); font-size: 11px; font-weight: 400; transition: color .15s; }
.pm-palette-item:hover .pm-mod-name { color: var(--text-primary); }
.pm-palette-item .pm-mod-desc { font-family: var(--sans); color: var(--text-dim); font-size: 10px; margin-top: 1px; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; opacity: 0.7; }
.pm-palette-item.dragging { opacity: 0.4; }

/* Planner (right) */
.pm-planner { flex: 1; display: flex; flex-direction: column; height: 100%; overflow: hidden; background: var(--bg-deep); }
.pm-planner-toolbar { display: flex; gap: 6px; padding: 10px 16px; border-bottom: 1px solid var(--border); align-items: center; flex-wrap: wrap; background: var(--bg-secondary); }
.pm-planner-toolbar button { padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 5px; color: var(--text-secondary); font-family: var(--mono); font-size: 10px; cursor: pointer; transition: all 0.15s; white-space: nowrap; letter-spacing: 0.3px; }
.pm-planner-toolbar button:hover { border-color: var(--border-light); color: var(--text-primary); background: var(--border); }
.pm-planner-toolbar button.send-btn { background: transparent; border-color: rgba(74,180,74,0.3); color: rgba(120,200,120,0.8); }
.pm-planner-toolbar button.send-btn:hover { background: rgba(74,180,74,0.08); border-color: rgba(74,180,74,0.5); color: #8e8; }
.pm-planner-toolbar .pm-separator { width: 1px; height: 20px; background: var(--border); margin: 0 4px; }
.pm-planner-title-row { display: flex; align-items: center; gap: 12px; padding: 16px 20px; border-bottom: 1px solid var(--border); background: var(--bg-primary); }
.pm-planner-title-row input { flex: 1; background: transparent; border: none; border-bottom: 1px solid var(--border); border-radius: 0; padding: 6px 2px; color: var(--text-primary); font-family: var(--display); font-size: 22px; font-weight: 400; letter-spacing: -0.01em; outline: none; transition: border-color .15s; }
.pm-planner-title-row input:focus { border-color: var(--accent-dim); }
.pm-planner-title-row input::placeholder { color: var(--text-dim); }

/* Planner Sections */
.pm-sections { flex: 1; overflow-y: auto; padding: 16px 20px; }
.pm-section { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; margin-bottom: 6px; transition: all 0.15s; border-left: 3px solid var(--border); position: relative; }
.pm-section:hover { border-left-color: var(--accent-dim); }
.pm-section.expanded { border-left-color: var(--accent); }
.pm-section.drag-over { border-color: var(--accent-dim); box-shadow: 0 0 16px var(--accent-glow); border-left-color: var(--accent); }
.pm-section.dragging-section { opacity: 0.4; }
.pm-section-header { display: flex; align-items: center; gap: 8px; padding: 9px 12px; cursor: pointer; transition: background .1s; }
.pm-section-header:hover { background: rgba(255,255,255,0.02); }
.pm-section-drag { cursor: grab; color: var(--text-dim); font-size: 12px; padding: 2px; opacity: 0.5; transition: opacity .15s; }
.pm-section-header:hover .pm-section-drag { opacity: 1; }
.pm-section-drag:active { cursor: grabbing; }
.pm-section-check { accent-color: var(--accent); }
.pm-section-num { font-family: var(--mono); color: var(--text-dim); font-size: 9px; font-weight: 600; min-width: 18px; opacity: 0.6; }
.pm-section-module { font-family: var(--mono); color: var(--accent); font-size: 11px; font-weight: 500; flex: 1; letter-spacing: 0.2px; }
.pm-section-actions { display: flex; gap: 3px; opacity: 0.5; transition: opacity .15s; }
.pm-section-header:hover .pm-section-actions { opacity: 1; }
.pm-section-actions button { background: transparent; border: 1px solid transparent; border-radius: 4px; font-family: var(--mono); color: var(--text-dim); font-size: 10px; padding: 3px 8px; cursor: pointer; transition: all .15s; }
.pm-section-actions button:hover { border-color: var(--border); background: var(--bg-tertiary); color: var(--text-secondary); }
.pm-section-actions button.open-btn { color: var(--accent-dim); }
.pm-section-actions button.open-btn:hover { border-color: var(--accent-dim); color: var(--accent); background: var(--accent-glow); }
.pm-section-actions button.del-btn:hover { border-color: rgba(200,60,60,0.3); color: #e66; background: rgba(200,60,60,0.06); }
.pm-section-body { padding: 0 12px 12px; display: none; }
.pm-section.expanded .pm-section-body { display: block; }
.pm-section-body .pm-field { margin-bottom: 8px; }
.pm-section-body .pm-field label { display: block; font-family: var(--mono); color: var(--text-dim); font-size: 9px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 4px; }
.pm-section-body .pm-field input, .pm-section-body .pm-field textarea, .pm-section-body .pm-field select { width: 100%; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 5px; padding: 7px 10px; color: var(--text-primary); font-family: var(--mono); font-size: 11px; outline: none; transition: border-color .15s; }
.pm-section-body .pm-field input:focus, .pm-section-body .pm-field textarea:focus, .pm-section-body .pm-field select:focus { border-color: var(--accent-dim); }
.pm-section-body .pm-field textarea { resize: vertical; min-height: 50px; font-family: var(--sans); }
.pm-section-body .pm-row { display: flex; gap: 8px; }
.pm-section-body .pm-row .pm-field { flex: 1; }
.pm-section-expand-icon { color: var(--text-dim); font-size: 9px; transition: transform 0.2s; opacity: 0.4; }
.pm-section.expanded .pm-section-expand-icon { transform: rotate(90deg); opacity: 0.8; }

/* Drop Zone */
.pm-dropzone { border: 1px dashed var(--border); border-radius: 6px; padding: 32px 20px; text-align: center; font-family: var(--mono); color: var(--text-dim); font-size: 10px; letter-spacing: 0.5px; margin-top: 8px; transition: all 0.2s; opacity: 0.6; }
.pm-dropzone:hover { opacity: 0.8; }
.pm-dropzone.drag-hover { border-color: var(--accent-dim); border-style: solid; background: var(--accent-glow); color: var(--accent); opacity: 1; }

/* Load Projects Modal */
.pm-load-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center; }
.pm-load-modal.active { display: flex; }
.pm-load-modal-content { background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; max-height: 70vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
.pm-load-modal-content h3 { font-family: var(--mono); color: var(--accent); font-size: 11px; font-weight: 500; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 16px; }
.pm-load-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 6px; margin-bottom: 6px; transition: border-color .15s; }
.pm-load-item:hover { border-color: var(--border-light); }
.pm-load-item span { font-family: var(--sans); color: var(--text-primary); font-size: 13px; }
.pm-load-item small { font-family: var(--mono); color: var(--text-dim); font-size: 10px; margin-left: 8px; }
.pm-load-item button { padding: 5px 12px; border: none; border-radius: 4px; cursor: pointer; font-family: var(--mono); font-size: 10px; text-transform: uppercase; letter-spacing: 0.3px; transition: all .15s; }
.pm-load-btn { background: var(--accent); color: #0a0a0a; font-weight: 600; margin-right: 4px; }
.pm-load-btn:hover { opacity: 0.85; }
.pm-del-btn { background: var(--bg-tertiary); color: var(--text-dim); border: 1px solid var(--border); }
.pm-del-btn:hover { border-color: #5a2a2a; color: #e66; }
</style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <h1>Presentation <span style="color:var(--accent);">Disco</span> <span style="font-size: 10px; font-weight: 300;">v222</span></h1>
        <p>Scroll-driven storytelling modules</p>
        <input type="password" id="passwordInput" placeholder="Enter password" onkeypress="if(event.key==='Enter')checkPassword()">
        <button onclick="checkPassword()">Enter</button>
        <div class="login-error" id="loginError">Incorrect password</div>
    </div>
</div>

<div id="hubScreen">
    <div class="hub-header">
        <h1>Presentation <span style="color:var(--accent);">Disco</span> <span style="font-size: 10px; font-weight: 300;">v222</span></h1>
        <div style="display:flex;align-items:center;gap:12px;">
            <div class="mode-toggle">
                <button id="assetModeBtn" class="active" onclick="switchMode('asset')">Asset Mode</button>
                <button id="presentationModeBtn" onclick="switchMode('presentation')">Presentation Mode</button>
            </div>
            <button onclick="logout()">Logout</button>
        </div>
    </div>
    
    <div id="assetMode">
    
    <div class="section-title">Modules</div>
    <div class="landing-grid">
        <a href="before-after.html" class="module-card" data-module="before-after"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Before/After</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('before-after-demo.html', 'Before/After')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Scroll-driven comparison slider between two images with drag and scroll modes.</p>
        </a>
        <a href="card-stack.html" class="module-card" data-module="card-stack"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Card Stack</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('card-stack-demo.html', 'Card Stack')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Stacked cards that fly away on scroll, revealing content beneath.</p>
        </a>
        <a href="chart.html" class="module-card" data-module="chart"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Chart</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('chart-demo.html', 'Chart')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Scroll-driven bar and pie charts with staggered animations.</p>
        </a>
        <a href="collage.html" class="module-card" data-module="collage"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Collage</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('collage-demo.html', 'Collage')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Multi-image grid layout with per-image positioning controls.</p>
        </a>
        <a href="doc-module.html" class="module-card" data-module="doc-module"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Doc Module</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('doc-module-demo.html', 'Doc Module')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Document image with animated highlight bars that reveal on scroll. Blend modes and aspect ratio controls.</p>
        </a>
        <a href="gallery.html" class="module-card" data-module="gallery"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Gallery</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('gallery-demo.html', 'Gallery')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Scroll-driven image sequence with transitions and text overlays.</p>
        </a>
        <a href="globe.html" class="module-card" data-module="globe"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Globe</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('globe-demo.html', 'Globe')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>3D WebGL globe with animated location markers and connection lines.</p>
        </a>
        <a href="hotspots.html" class="module-card" data-module="hotspots"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Hotspots</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('hotspots-demo.html', 'Hotspots')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Interactive annotation points that appear at scroll positions.</p>
        </a>
        <a href="layers.html" class="module-card" data-module="layers"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Layers</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('layers-demo.html', 'Layers')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Multi-layer parallax compositions with various animation effects.</p>
        </a>
        <a href="matte.html" class="module-card" data-module="matte"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Matte</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('matte-demo.html', 'Matte')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Text or image matte reveals with scroll-driven animation and background clipping.</p>
        </a>
        <a href="single-image.html" class="module-card" data-module="single-image"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Single Image</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('single-image-demo.html', 'Single Image')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Hero images with scroll-driven effects like zoom, parallax, tilt.</p>
        </a>
        <a href="stat-counter.html" class="module-card" data-module="stat-counter"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Stat Counter</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('stat-counter-demo.html', 'Stat Counter')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Animated number counters that increment on scroll.</p>
        </a>
        <a href="timeline.html" class="module-card" data-module="timeline"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Timeline</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('timeline-demo.html', 'Timeline')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Vertical timeline with events that reveal on scroll.</p>
        </a>
        <a href="video.html" class="module-card" data-module="video"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Video</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('video-demo.html', 'Video')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Scroll-controlled video playback with text overlays.</p>
        </a>
        <a href="zoom-detail.html" class="module-card" data-module="zoom-detail"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Zoom Detail</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('zoom-detail-demo.html', 'Zoom Detail')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Progressive zoom into a specific image region on scroll.</p>
        </a>
    </div>
    
    <div class="section-title">Text Modules</div>
    <div class="landing-grid">
        <a href="text-scroll.html" class="module-card" data-module="text-scroll"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Text Scroll</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('text-scroll-demo.html', 'Text Scroll')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Punchy statement blocks with crossfading background images or solid colors.</p>
        </a>
        <a href="chapter-marker.html" class="module-card" data-module="chapter-marker"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Chapter Marker</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('chapter-marker-demo.html', 'Chapter Marker')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Full-viewport section dividers with animated text reveals including random letters effect.</p>
        </a>
        <a href="key-facts.html" class="module-card" data-module="key-facts"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Key Facts Panel</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('key-facts-demo.html', 'Key Facts Panel')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Structured info box with staggered reveal animations and source attribution.</p>
        </a>
        <a href="body-module.html" class="module-card" data-module="body-module"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Body Module</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('body-module-demo.html', 'Body Module')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Traditional article text with optional floating image and fullscreen lightbox.</p>
        </a>
        <a href="pull-quote.html" class="module-card" data-module="pull-quote"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Pull Quote</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('pull-quote-demo.html', 'Pull Quote')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Large-format text display with scroll-triggered reveal animations.</p>
        </a>
    </div>

    <div class="section-title">Fact Focus Modules</div>
    <div class="landing-grid">
        <a href="epistemic-text.html" class="module-card" data-module="epistemic-text"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Epistemic Text</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('epistemic-text-demo.html', 'Epistemic Text')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Confidence-tagged article text with toggleable claim verification overlays.</p>
        </a>
        <a href="adversarial-verification.html" class="module-card" data-module="adversarial-verification"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Adversarial Verification</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('adversarial-verification-demo.html', 'Adversarial Verification')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Interactive claim challenges with expandable evidence chains and progress tracking.</p>
        </a>
        <a href="silence-mapping.html" class="module-card" data-module="silence-mapping"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Silence Mapping</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('silence-mapping-demo.html', 'Silence Mapping')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Document reporting gaps — denied sources, pending FOIAs, and scope limitations with expandable timelines.</p>
        </a>
        <a href="multi-angle.html" class="module-card" data-module="multi-angle"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Multi-Angle Investigation</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('multi-angle-demo.html', 'Multi-Angle Investigation')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Compare multiple sources side-by-side with annotated media, lightbox viewer, and source attribution.</p>
        </a>
        <a href="clock-narrative.html" class="module-card" data-module="clock-narrative"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Clock Narrative</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('clock-narrative-demo.html', 'Clock Narrative')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Chronological event timeline with animated clock face, time-synced entries, and scroll-driven playback.</p>
        </a>
        <a href="claim-evidence.html" class="module-card" data-module="claim-evidence"><span class="status-dot"></span>
            <div class="module-card-header">
                <h3>Claim vs Evidence</h3>
                <button class="demo-btn" onclick="event.preventDefault(); openDemo('claim-evidence-demo.html', 'Claim vs Evidence')"><span class="play-icon">▶</span> demo</button>
            </div>
            <p>Side-by-side claim vs. evidence comparison with split-panel layout and navigable entry dots.</p>
        </a>
    </div>
    
    <div class="section-title">Tools</div>
    <div class="landing-grid">
        <a href="stack-builder-clean.html" class="module-card"><h3>Stack Builder</h3><p>Combine multiple module exports into a single seamless scroll story.</p></a>
        <a href="story-planner.html" class="module-card"><h3>Presentation Planner</h3><p>Plan your scroll presentation structure, assign modules, and export content to modules.</p></a>
        <a href="coordinate-finder.html" class="module-card"><h3>Coordinate Finder</h3><p>Click a map to get lat/long coordinates for the Globe module.</p></a>
        <a href="responsive-preview.html" class="module-card"><h3>Responsive Preview</h3><p>Test module code at different screen sizes before embedding.</p></a>
        <a href="image-sequence.html" class="module-card"><h3>Asset Exporter</h3><p>Export scroll stories as PNG frames for Resolve, Premiere, After Effects.</p></a>
    </div>
    
    <div class="section-title">Session</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;max-width:1200px;margin:0 auto;justify-content:space-between;align-items:center;">
        <div style="display:flex;gap:10px;">
            <button onclick="saveSession()" style="padding:8px 16px;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:6px;color:var(--text-secondary);cursor:pointer;font-family:var(--mono);font-size:10px;text-transform:uppercase;letter-spacing:0.5px;transition:all .15s;">Save Session</button>
            <button onclick="document.getElementById('loadSessionInput').click()" style="padding:8px 16px;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:6px;color:var(--text-secondary);cursor:pointer;font-family:var(--mono);font-size:10px;text-transform:uppercase;letter-spacing:0.5px;transition:all .15s;">Load Session</button>
            <button onclick="clearAllData()" style="padding:8px 16px;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:6px;color:var(--text-secondary);cursor:pointer;font-family:var(--mono);font-size:10px;text-transform:uppercase;letter-spacing:0.5px;transition:all .15s;">Clear All</button>
            <input type="file" id="loadSessionInput" accept=".json" onchange="loadSession(event)" style="display:none;">
        </div>
        <button onclick="openWorkFolder()" style="padding:8px 16px;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:6px;color:var(--text-secondary);cursor:pointer;font-family:var(--mono);font-size:10px;text-transform:uppercase;letter-spacing:0.5px;transition:all .15s;">Work Folder</button>
    </div>
    </div><!-- end assetMode -->

    <!-- Presentation Mode -->
    <div id="presentationMode">
        <div class="pm-palette">
            <div class="pm-palette-header"><h3>Modules</h3></div>
            <div class="pm-palette-list" id="pmPaletteList"></div>
        </div>
        <div class="pm-planner">
            <div class="pm-planner-toolbar">
                <button onclick="pmNew()">+ New</button>
                <button onclick="pmSave()">Save</button>
                <button onclick="pmOpenLoad()">Load</button>
                <div class="pm-separator"></div>
                <button class="send-btn" onclick="pmSendAll()">Send All</button>
                <button class="send-btn" onclick="pmSendSelected()">Send Selected</button>
                <div class="pm-separator"></div>
                <button onclick="window.open('stack-builder-clean.html')">Stack Builder</button>
            </div>
            <div class="pm-planner-title-row">
                <input type="text" id="pmProjectTitle" value="Untitled Presentation" placeholder="Presentation title...">
            </div>
            <div class="pm-sections" id="pmSections">
                <div class="pm-dropzone" id="pmDropzone">Drag modules here to build your presentation</div>
            </div>
        </div>
    </div>

    <!-- Load Projects Modal (Presentation Mode) -->
    <div class="pm-load-modal" id="pmLoadModal" onclick="if(event.target===this)pmCloseLoad()">
        <div class="pm-load-modal-content">
            <h3>Load Project</h3>
            <div id="pmLoadList"></div>
            <div style="text-align:right;margin-top:16px;"><button onclick="pmCloseLoad()" style="padding:7px 16px;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:6px;color:var(--text-dim);cursor:pointer;font-family:var(--mono);font-size:10px;text-transform:uppercase;letter-spacing:0.5px;">Close</button></div>
        </div>
    </div>
</div>

<!-- Save Session Modal -->
<div id="saveModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:10000;align-items:center;justify-content:center;">
    <div style="background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:12px;padding:28px;max-width:400px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,0.5);">
        <h3 style="font-family:var(--mono);color:var(--accent);font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:18px;">Save Session</h3>
        <input type="text" id="sessionName" placeholder="Session name" style="width:100%;padding:9px 12px;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-family:var(--mono);font-size:12px;margin-bottom:18px;outline:none;">
        <div style="display:flex;gap:8px;justify-content:flex-end;">
            <button onclick="closeSaveModal()" style="padding:7px 16px;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:6px;color:var(--text-dim);cursor:pointer;font-family:var(--mono);font-size:10px;text-transform:uppercase;letter-spacing:0.5px;">Cancel</button>
            <button onclick="confirmSaveSession()" style="padding:7px 16px;background:var(--accent);border:1px solid var(--accent);border-radius:6px;color:#0a0a0a;font-weight:600;cursor:pointer;font-family:var(--mono);font-size:10px;text-transform:uppercase;letter-spacing:0.5px;">Save</button>
        </div>
    </div>
</div>

<!-- Demo Modal -->
<div class="demo-modal" id="demoModal">
    <div class="demo-modal-content">
        <div class="demo-modal-header">
            <h3 id="demoTitle">Demo</h3>
            <button class="demo-modal-close" onclick="closeDemo()">✕</button>
        </div>
        <div class="demo-modal-body">
            <iframe id="demoIframe" src=""></iframe>
        </div>
    </div>
</div>

<script>
const PASS_HASH = '44c7be8469ab4904ff80ba58bdcf860c';

function md5(s){function L(k,d){return(k<<d)|(k>>>(32-d))}function K(G,k){var I,d,F,H,x;F=(G&2147483648);H=(k&2147483648);I=(G&1073741824);d=(k&1073741824);x=(G&1073741823)+(k&1073741823);if(I&d){return(x^2147483648^F^H)}if(I|d){if(x&1073741824){return(x^3221225472^F^H)}else{return(x^1073741824^F^H)}}else{return(x^F^H)}}function r(d,F,k){return(d&F)|((~d)&k)}function q(d,F,k){return(d&k)|(F&(~k))}function p(d,F,k){return(d^F^k)}function n(d,F,k){return(F^(d|(~k)))}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F)}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F)}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F)}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F)}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-(x%64))/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;var H=0;while(H<F){Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=(aa[Z]|(G.charCodeAt(H)<<d));H++}Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=aa[Z]|(128<<d);aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa}function B(x){var k="",F="",G,d;for(d=0;d<=3;d++){G=(x>>>(d*8))&255;F="0"+G.toString(16);k=k+F.substr(F.length-2,2)}return k}function J(k){k=k.replace(/\r\n/g,"\n");var d="";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128){d+=String.fromCharCode(x)}else{if((x>127)&&(x<2048)){d+=String.fromCharCode((x>>6)|192);d+=String.fromCharCode((x&63)|128)}else{d+=String.fromCharCode((x>>12)|224);d+=String.fromCharCode(((x>>6)&63)|128);d+=String.fromCharCode((x&63)|128)}}}return d}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g)}return(B(Y)+B(X)+B(W)+B(V)).toLowerCase()}

function checkPassword() {
    const input = document.getElementById('passwordInput').value;
    if (md5(input) === PASS_HASH) {
        sessionStorage.setItem('disco_auth', '1');
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('hubScreen').style.display = 'block';
    } else {
        document.getElementById('loginError').style.display = 'block';
        document.getElementById('passwordInput').value = '';
    }
}

function logout() {
    discoConfirm('Log out and clear all saved module data?\n\nThis will reset all modules to defaults.', function(){// Clear all disco_ localStorage keys
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith('disco_')) {
                localStorage.removeItem(key);
            }
        });
        sessionStorage.removeItem('disco_auth');
        location.reload();});
}

function openDemo(demoFile, title) {
    document.getElementById('demoTitle').textContent = title + ' Demo';
    document.getElementById('demoIframe').src = 'demos/' + demoFile;
    document.getElementById('demoModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeDemo() {
    document.getElementById('demoModal').classList.remove('active');
    document.getElementById('demoIframe').src = '';
    document.body.style.overflow = '';
}

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closeDemo();
});

// Close modal on backdrop click
document.getElementById('demoModal').addEventListener('click', function(e) {
    if (e.target === this) closeDemo();
});

if (sessionStorage.getItem('disco_auth') === '1') {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('hubScreen').style.display = 'block';
}

// Update status dots for modules with saved content
document.querySelectorAll('.module-card[data-module]').forEach(function(card) {
    var mod = card.getAttribute('data-module');
    var key = 'disco_' + mod;
    var dot = card.querySelector('.status-dot');
    if (!dot) return;
    var hasContent = localStorage.getItem(key);
    var fromPlanner = localStorage.getItem(key + '_from_planner');
    if (hasContent) {
        if (fromPlanner === 'true') {
            dot.className = 'status-dot orange';
        } else {
            dot.className = 'status-dot green';
        }
    }
});

document.getElementById('passwordInput').focus();

// Session management
function saveSession() {
    document.getElementById('saveModal').style.display = 'flex';
    document.getElementById('sessionName').value = '';
    document.getElementById('sessionName').focus();
}

function closeSaveModal() {
    document.getElementById('saveModal').style.display = 'none';
}

function confirmSaveSession() {
    var name = document.getElementById('sessionName').value.trim();
    if (!name) {
        discoAlert('Please enter a session name');
        return;
    }
    
    // Collect all scrolltastic localStorage keys
    var sessionData = {};
    for (var i = 0; i < localStorage.length; i++) {
        var key = localStorage.key(i);
        if (key && (key.startsWith('disco_') || key.startsWith('scrolltastic_') || key.startsWith('stack_'))) {
            sessionData[key] = localStorage.getItem(key);
        }
    }
    
    // Add metadata
    sessionData._meta = {
        name: name,
        date: new Date().toISOString(),
        version: 'v118'
    };
    
    // Download as JSON
    var blob = new Blob([JSON.stringify(sessionData, null, 2)], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = name.replace(/[^a-z0-9]/gi, '_') + '_session.json';
    a.click();
    URL.revokeObjectURL(url);
    
    closeSaveModal();
}

function loadSession(event) {
    var file = event.target.files[0];
    if (!file) return;
    
    var reader = new FileReader();
    reader.onload = function(e) {
        try {
            var sessionData = JSON.parse(e.target.result);
            var meta = sessionData._meta || {};
            
            // Confirm restore
            var msg = 'Load session';
            if (meta.name) msg += ' "' + meta.name + '"';
            if (meta.date) msg += ' from ' + new Date(meta.date).toLocaleDateString();
            msg += '?\n\nThis will replace your current session data.';
            
            discoConfirm(msg, function(){
            // Clear existing scrolltastic data
            var keysToRemove = [];
            for (var i = 0; i < localStorage.length; i++) {
                var key = localStorage.key(i);
                if (key && (key.startsWith('disco_') || key.startsWith('scrolltastic_') || key.startsWith('stack_'))) {
                    keysToRemove.push(key);
                }
            }
            keysToRemove.forEach(function(key) {
                localStorage.removeItem(key);
            });
            
            // Restore session data
            var count = 0;
            for (var key in sessionData) {
                if (key !== '_meta') {
                    localStorage.setItem(key, sessionData[key]);
                    count++;
                }
            }
            
            discoAlert('Session loaded! Restored ' + count + ' items.\n\nRefreshing page...');
            location.reload();
            });
            
        } catch (err) {
            discoAlert('Error loading session: ' + err.message);
        }
    };
    reader.readAsText(file);
    event.target.value = '';
}

function clearAllData() {
    var keysToRemove = [];
    for (var i = 0; i < localStorage.length; i++) {
        var key = localStorage.key(i);
        if (key && (key.startsWith('disco_') || key.startsWith('scrolltastic_') || key.startsWith('stack_'))) {
            keysToRemove.push(key);
        }
    }
    
    if (keysToRemove.length === 0) {
        discoAlert('No session data to clear.');
        return;
    }
    
    discoConfirm('Clear all session data?\n\nThis will remove ' + keysToRemove.length + ' saved items and cannot be undone.', function() {
    keysToRemove.forEach(function(key) {
        localStorage.removeItem(key);
    });
    
    discoAlert('Cleared ' + keysToRemove.length + ' items.\n\nRefreshing page...');
    location.reload();
});
}

function openWorkFolder() {
    window.open('asset-bin.html', 'WorkFolder', 'width=800,height=600,menubar=no,toolbar=no,location=no,status=no');
}

// Allow Enter key in save modal
document.getElementById('sessionName').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') confirmSaveSession();
    if (e.key === 'Escape') closeSaveModal();
});

// =========================================
// PRESENTATION MODE
// =========================================

var PM_STORAGE = 'disco_pm_planner';
var PM_PROJECTS = 'disco_pm_projects';
var PM_MODE_KEY = 'disco_hub_mode';
var pmSections = [];
var pmSectionId = 0;

// Module registry
var PM_MODULES = [
    { cat: 'Visual', name: 'Before/After', href: 'before-after.html', key: 'before-after', desc: 'Scroll-driven comparison slider' },
    { cat: 'Visual', name: 'Card Stack', href: 'card-stack.html', key: 'card-stack', desc: 'Cards that fly away on scroll' },
    { cat: 'Visual', name: 'Chart', href: 'chart.html', key: 'chart', desc: 'Animated bar and pie charts' },
    { cat: 'Visual', name: 'Collage', href: 'collage.html', key: 'collage', desc: 'Multi-image grid layout' },
    { cat: 'Visual', name: 'Doc Module', href: 'doc-module.html', key: 'doc-module', desc: 'Document with highlight bars' },
    { cat: 'Visual', name: 'Gallery', href: 'gallery.html', key: 'gallery', desc: 'Image sequence with transitions' },
    { cat: 'Visual', name: 'Globe', href: 'globe.html', key: 'globe', desc: '3D globe with markers' },
    { cat: 'Visual', name: 'Hotspots', href: 'hotspots.html', key: 'hotspots', desc: 'Interactive annotation points' },
    { cat: 'Visual', name: 'Layers', href: 'layers.html', key: 'layers', desc: 'Multi-layer parallax' },
    { cat: 'Visual', name: 'Matte', href: 'matte.html', key: 'matte', desc: 'Text/image matte reveals' },
    { cat: 'Visual', name: 'Single Image', href: 'single-image.html', key: 'single-image', desc: 'Hero images with scroll effects' },
    { cat: 'Visual', name: 'Stat Counter', href: 'stat-counter.html', key: 'stat-counter', desc: 'Animated number counters' },
    { cat: 'Visual', name: 'Timeline', href: 'timeline.html', key: 'timeline', desc: 'Vertical timeline with events' },
    { cat: 'Visual', name: 'Video', href: 'video.html', key: 'video', desc: 'Scroll-controlled video' },
    { cat: 'Visual', name: 'Zoom Detail', href: 'zoom-detail.html', key: 'zoom-detail', desc: 'Progressive zoom into image' },
    { cat: 'Text', name: 'Text Scroll', href: 'text-scroll.html', key: 'text-scroll', desc: 'Statement blocks with backgrounds' },
    { cat: 'Text', name: 'Chapter Marker', href: 'chapter-marker.html', key: 'chapter-marker', desc: 'Section dividers with text reveals' },
    { cat: 'Text', name: 'Key Facts Panel', href: 'key-facts.html', key: 'key-facts', desc: 'Structured info box' },
    { cat: 'Text', name: 'Body Module', href: 'body-module.html', key: 'body-module', desc: 'Article text with floating image' },
    { cat: 'Text', name: 'Pull Quote', href: 'pull-quote.html', key: 'pull-quote', desc: 'Large-format quote display' },
    { cat: 'Fact Focus', name: 'Epistemic Text', href: 'epistemic-text.html', key: 'epistemic-text', desc: 'Confidence-tagged text' },
    { cat: 'Fact Focus', name: 'Adversarial Verification', href: 'adversarial-verification.html', key: 'adversarial-verification', desc: 'Claim challenges with evidence' },
    { cat: 'Fact Focus', name: 'Silence Mapping', href: 'silence-mapping.html', key: 'silence-mapping', desc: 'Document reporting gaps' },
    { cat: 'Fact Focus', name: 'Multi-Angle Investigation', href: 'multi-angle.html', key: 'multi-angle', desc: 'Compare multiple sources' },
    { cat: 'Fact Focus', name: 'Clock Narrative', href: 'clock-narrative.html', key: 'clock-narrative', desc: 'Chronological event timeline' },
    { cat: 'Fact Focus', name: 'Claim vs Evidence', href: 'claim-evidence.html', key: 'claim-evidence', desc: 'Side-by-side claim comparison' }
];

// Mode switching
function switchMode(mode) {
    var assetMode = document.getElementById('assetMode');
    var presMode = document.getElementById('presentationMode');
    var assetBtn = document.getElementById('assetModeBtn');
    var presBtn = document.getElementById('presentationModeBtn');
    
    if (mode === 'presentation') {
        assetMode.style.display = 'none';
        presMode.classList.add('active');
        assetBtn.classList.remove('active');
        presBtn.classList.add('active');
        sessionStorage.setItem(PM_MODE_KEY, 'presentation');
    } else {
        assetMode.style.display = '';
        presMode.classList.remove('active');
        presBtn.classList.remove('active');
        assetBtn.classList.add('active');
        sessionStorage.setItem(PM_MODE_KEY, 'asset');
    }
}

// Build palette
function pmBuildPalette() {
    var list = document.getElementById('pmPaletteList');
    var html = '';
    var lastCat = '';
    PM_MODULES.forEach(function(mod, i) {
        if (mod.cat !== lastCat) {
            html += '<div class="pm-palette-cat">' + mod.cat + '</div>';
            lastCat = mod.cat;
        }
        html += '<div class="pm-palette-item" draggable="true" data-idx="' + i + '" ondragstart="pmDragStart(event,' + i + ')" ondblclick="window.open(\'' + mod.href + '?planner=1\')">' +
            '<div class="pm-mod-name">' + mod.name + '</div>' +
            '<div class="pm-mod-desc">' + mod.desc + '</div></div>';
    });
    list.innerHTML = html;
}

// Drag from palette
var pmDragIdx = -1;
function pmDragStart(e, idx) {
    pmDragIdx = idx;
    e.dataTransfer.effectAllowed = 'copy';
    e.dataTransfer.setData('text/plain', idx);
    e.target.classList.add('dragging');
    setTimeout(function() { e.target.classList.remove('dragging'); }, 200);
}

// Drop zone and section reordering
function pmInitDrop() {
    var sectionsEl = document.getElementById('pmSections');
    
    sectionsEl.addEventListener('dragover', function(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = pmDragIdx >= 0 ? 'copy' : 'move';
        var dz = document.getElementById('pmDropzone');
        if (dz) dz.classList.add('drag-hover');
        
        // Find closest section for reorder indicator
        var sections = sectionsEl.querySelectorAll('.pm-section');
        sections.forEach(function(s) { s.classList.remove('drag-over'); });
        var closest = pmGetClosestSection(sectionsEl, e.clientY);
        if (closest) closest.classList.add('drag-over');
    });
    
    sectionsEl.addEventListener('dragleave', function(e) {
        if (!sectionsEl.contains(e.relatedTarget)) {
            var dz = document.getElementById('pmDropzone');
            if (dz) dz.classList.remove('drag-hover');
            sectionsEl.querySelectorAll('.pm-section').forEach(function(s) { s.classList.remove('drag-over'); });
        }
    });
    
    sectionsEl.addEventListener('drop', function(e) {
        e.preventDefault();
        var dz = document.getElementById('pmDropzone');
        if (dz) dz.classList.remove('drag-hover');
        sectionsEl.querySelectorAll('.pm-section').forEach(function(s) { s.classList.remove('drag-over'); });
        
        if (pmDragIdx >= 0) {
            // Drop from palette — add new section
            var mod = PM_MODULES[pmDragIdx];
            var insertIdx = pmGetInsertIndex(sectionsEl, e.clientY);
            pmAddSection(mod, insertIdx);
            pmDragIdx = -1;
        } else {
            // Reorder existing section
            var dragId = parseInt(e.dataTransfer.getData('text/plain'));
            if (!isNaN(dragId)) {
                var insertIdx = pmGetInsertIndex(sectionsEl, e.clientY);
                var fromIdx = pmSections.findIndex(function(s) { return s.id === dragId; });
                if (fromIdx >= 0 && fromIdx !== insertIdx) {
                    var item = pmSections.splice(fromIdx, 1)[0];
                    if (insertIdx > fromIdx) insertIdx--;
                    pmSections.splice(insertIdx, 0, item);
                    pmRender();
                    pmAutoSave();
                }
            }
        }
    });
}

function pmGetClosestSection(container, y) {
    var sections = container.querySelectorAll('.pm-section');
    var closest = null;
    var closestDist = Infinity;
    sections.forEach(function(s) {
        var rect = s.getBoundingClientRect();
        var mid = rect.top + rect.height / 2;
        var dist = Math.abs(y - mid);
        if (dist < closestDist) {
            closestDist = dist;
            closest = s;
        }
    });
    return closest;
}

function pmGetInsertIndex(container, y) {
    var sections = container.querySelectorAll('.pm-section');
    for (var i = 0; i < sections.length; i++) {
        var rect = sections[i].getBoundingClientRect();
        if (y < rect.top + rect.height / 2) return i;
    }
    return pmSections.length;
}

// Section management
function pmAddSection(mod, insertIdx) {
    var section = {
        id: ++pmSectionId,
        moduleKey: mod.key,
        moduleName: mod.name,
        moduleHref: mod.href,
        title: '',
        notes: '',
        layout: 'viewport',
        scrollBudget: 2000,
        selected: false,
        expanded: false
    };
    if (insertIdx !== undefined && insertIdx < pmSections.length) {
        pmSections.splice(insertIdx, 0, section);
    } else {
        pmSections.push(section);
    }
    pmRender();
    pmAutoSave();
}

function pmRemoveSection(id) {
    discoConfirm('Remove this section?', function() {
        pmSections = pmSections.filter(function(s) { return s.id !== id; });
        pmRender();
        pmAutoSave();
    });
}

function pmToggleExpand(id) {
    var s = pmSections.find(function(s) { return s.id === id; });
    if (s) s.expanded = !s.expanded;
    pmRender();
}

function pmOpenModule(section) {
    window.open(section.moduleHref + '?planner=1');
}

function pmUpdateField(id, field, value) {
    var s = pmSections.find(function(s) { return s.id === id; });
    if (s) {
        s[field] = value;
        pmAutoSave();
    }
}

function pmToggleSelect(id) {
    var s = pmSections.find(function(s) { return s.id === id; });
    if (s) {
        s.selected = !s.selected;
        pmAutoSave();
    }
}

function pmDuplicateSection(id) {
    var orig = pmSections.find(function(s) { return s.id === id; });
    if (!orig) return;
    var idx = pmSections.indexOf(orig);
    var copy = JSON.parse(JSON.stringify(orig));
    copy.id = ++pmSectionId;
    copy.title = orig.title ? orig.title + ' (copy)' : '';
    pmSections.splice(idx + 1, 0, copy);
    pmRender();
    pmAutoSave();
}

// Render sections
function pmRender() {
    var container = document.getElementById('pmSections');
    var html = '';
    
    pmSections.forEach(function(s, i) {
        var expandedClass = s.expanded ? ' expanded' : '';
        html += '<div class="pm-section' + expandedClass + '" data-id="' + s.id + '" draggable="true" ondragstart="pmSectionDragStart(event,' + s.id + ')">' +
            '<div class="pm-section-header" onclick="pmToggleExpand(' + s.id + ')">' +
                '<span class="pm-section-drag" title="Drag to reorder">⠿</span>' +
                '<input type="checkbox" class="pm-section-check" ' + (s.selected ? 'checked' : '') + ' onclick="event.stopPropagation();pmToggleSelect(' + s.id + ')" title="Select for send">' +
                '<span class="pm-section-num">' + (i + 1) + '</span>' +
                '<span class="pm-section-module">' + s.moduleName + '</span>' +
                (s.title ? '<span style="color:var(--text-dim);font-family:var(--sans);font-size:11px;font-style:italic;margin-right:8px;">' + s.title.substring(0, 30) + '</span>' : '') +
                '<span class="pm-section-expand-icon">▶</span>' +
                '<div class="pm-section-actions" onclick="event.stopPropagation()">' +
                    '<button class="open-btn" onclick="pmOpenModule(pmSections.find(function(x){return x.id===' + s.id + '}))" title="Open module editor">Open</button>' +
                    '<button onclick="pmDuplicateSection(' + s.id + ')" title="Duplicate">⧉</button>' +
                    '<button class="del-btn" onclick="pmRemoveSection(' + s.id + ')" title="Delete">✕</button>' +
                '</div>' +
            '</div>' +
            '<div class="pm-section-body">' +
                '<div class="pm-field"><label>Section Title</label><input type="text" value="' + (s.title || '').replace(/"/g, '&quot;') + '" onchange="pmUpdateField(' + s.id + ',\'title\',this.value)" placeholder="e.g. The Aftermath"></div>' +
                '<div class="pm-field"><label>Notes</label><textarea onchange="pmUpdateField(' + s.id + ',\'notes\',this.value)" placeholder="Editorial notes...">' + (s.notes || '') + '</textarea></div>' +
                '<div class="pm-row">' +
                    '<div class="pm-field"><label>Layout</label><select onchange="pmUpdateField(' + s.id + ',\'layout\',this.value)">' +
                        '<option value="viewport"' + (s.layout === 'viewport' ? ' selected' : '') + '>Viewport (scroll-driven)</option>' +
                        '<option value="flow"' + (s.layout === 'flow' ? ' selected' : '') + '>Flow (natural height)</option>' +
                    '</select></div>' +
                    '<div class="pm-field"><label>Scroll Budget (vh)</label><input type="number" value="' + s.scrollBudget + '" onchange="pmUpdateField(' + s.id + ',\'scrollBudget\',parseInt(this.value)||2000)" min="0" step="100"></div>' +
                '</div>' +
            '</div>' +
        '</div>';
    });
    
    html += '<div class="pm-dropzone" id="pmDropzone">' + 
        (pmSections.length === 0 ? 'Drag modules here to build your presentation' : '+ Drop module here') + 
        '</div>';
    
    container.innerHTML = html;
}

// Section drag for reorder
function pmSectionDragStart(e, id) {
    pmDragIdx = -1; // Not from palette
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', id);
    e.target.classList.add('dragging-section');
    setTimeout(function() { e.target.classList.remove('dragging-section'); }, 200);
}

// Auto-save
function pmAutoSave() {
    var data = {
        title: document.getElementById('pmProjectTitle').value,
        sections: pmSections,
        sectionId: pmSectionId
    };
    localStorage.setItem(PM_STORAGE, JSON.stringify(data));
}

// Load state
function pmLoadState() {
    try {
        var data = JSON.parse(localStorage.getItem(PM_STORAGE));
        if (data) {
            document.getElementById('pmProjectTitle').value = data.title || 'Untitled Presentation';
            pmSections = data.sections || [];
            pmSectionId = data.sectionId || 0;
        }
    } catch(e) {}
    pmRender();
}

// New project
function pmNew() {
    if (pmSections.length > 0) {
        discoConfirm('Start a new project? Unsaved changes will be lost.', function() {
            document.getElementById('pmProjectTitle').value = 'Untitled Presentation';
            pmSections = [];
            pmSectionId = 0;
            pmRender();
            pmAutoSave();
        });
    } else {
        document.getElementById('pmProjectTitle').value = 'Untitled Presentation';
        pmSections = [];
        pmSectionId = 0;
        pmRender();
        pmAutoSave();
    }
}

// Save project
function pmSave() {
    var title = document.getElementById('pmProjectTitle').value.trim() || 'Untitled';
    var projects = JSON.parse(localStorage.getItem(PM_PROJECTS) || '[]');
    
    var project = {
        id: Date.now(),
        title: title,
        date: new Date().toISOString(),
        sections: JSON.parse(JSON.stringify(pmSections)),
        sectionId: pmSectionId
    };
    projects.push(project);
    localStorage.setItem(PM_PROJECTS, JSON.stringify(projects));
    discoAlert('Project saved: ' + title);
}

// Load project
function pmOpenLoad() {
    var projects = JSON.parse(localStorage.getItem(PM_PROJECTS) || '[]');
    var container = document.getElementById('pmLoadList');
    
    if (projects.length === 0) {
        container.innerHTML = '<p style="color:var(--text-dim);text-align:center;padding:30px;font-family:var(--mono);font-size:11px;">No saved projects</p>';
    } else {
        var html = '';
        projects.forEach(function(p) {
            var date = new Date(p.date).toLocaleDateString();
            html += '<div class="pm-load-item">' +
                '<div><span>' + p.title + '</span><small>' + date + ' · ' + (p.sections ? p.sections.length : 0) + ' sections</small></div>' +
                '<div><button class="pm-load-btn" onclick="pmLoadProject(' + p.id + ')">Load</button>' +
                '<button class="pm-del-btn" onclick="pmDeleteProject(' + p.id + ')">Delete</button></div></div>';
        });
        container.innerHTML = html;
    }
    document.getElementById('pmLoadModal').classList.add('active');
}

function pmCloseLoad() {
    document.getElementById('pmLoadModal').classList.remove('active');
}

function pmLoadProject(id) {
    var projects = JSON.parse(localStorage.getItem(PM_PROJECTS) || '[]');
    var project = projects.find(function(p) { return p.id === id; });
    if (!project) return;
    
    document.getElementById('pmProjectTitle').value = project.title;
    pmSections = project.sections || [];
    pmSectionId = project.sectionId || 0;
    pmRender();
    pmAutoSave();
    pmCloseLoad();
}

function pmDeleteProject(id) {
    discoConfirm('Delete this project?', function() {
        var projects = JSON.parse(localStorage.getItem(PM_PROJECTS) || '[]');
        projects = projects.filter(function(p) { return p.id !== id; });
        localStorage.setItem(PM_PROJECTS, JSON.stringify(projects));
        pmOpenLoad(); // Refresh list
    });
}

// Send to Stack Builder
function pmSendSections(sections) {
    if (sections.length === 0) {
        discoAlert('No sections to send.');
        return;
    }
    
    // Collect generated HTML from each module's export localStorage key
    var queue = JSON.parse(localStorage.getItem('disco_stack_queue') || '[]');
    var sent = 0;
    var skipped = [];
    
    sections.forEach(function(s) {
        var exportKey = 'disco_' + s.moduleKey + '_export';
        var html = localStorage.getItem(exportKey) || '';
        
        if (html) {
            queue.push({
                name: s.title || s.moduleName,
                html: html,
                layout: s.layout,
                timestamp: Date.now()
            });
            sent++;
        } else {
            skipped.push(s.moduleName + (s.title ? ' (' + s.title + ')' : ''));
        }
    });
    
    if (sent === 0) {
        discoAlert('No modules have generated HTML yet.\n\nOpen each module and generate its export code first.');
        return;
    }
    
    localStorage.setItem('disco_stack_queue', JSON.stringify(queue));
    
    var msg = 'Sent ' + sent + ' module' + (sent > 1 ? 's' : '') + ' to Stack Builder!';
    if (skipped.length > 0) {
        msg += '\n\nSkipped (no export code):\n' + skipped.join('\n');
    }
    
    var o = document.getElementById('discoModalOverlay');
    var m = document.getElementById('discoModalMsg');
    var b = document.getElementById('discoModalBtns');
    m.textContent = msg;
    b.innerHTML = '<button class="disco-btn-secondary" onclick="discoCloseModal(\'cancel\')">Close</button><button class="disco-btn-primary" onclick="discoCloseModal(\'ok\')">Open Stack Builder now</button>';
    o.classList.add('active');
    window._discoOk = function() { window.location.href = 'stack-builder-clean.html'; };
    window._discoCancel = null;
    window._discoCb = null;
}

function pmSendAll() {
    pmSendSections(pmSections);
}

function pmSendSelected() {
    var selected = pmSections.filter(function(s) { return s.selected; });
    if (selected.length === 0) {
        discoAlert('No sections selected.\n\nUse the checkboxes to select sections to send.');
        return;
    }
    pmSendSections(selected);
}

// Title auto-save
document.getElementById('pmProjectTitle').addEventListener('input', function() {
    pmAutoSave();
});

// Initialize presentation mode
pmBuildPalette();
pmInitDrop();
pmLoadState();

// Restore mode
if (sessionStorage.getItem(PM_MODE_KEY) === 'presentation') {
    switchMode('presentation');
}
</script>

<div class="disco-modal-overlay" id="discoModalOverlay" onclick="if(event.target===this)discoCloseModal()"><div class="disco-modal"><div class="disco-modal-title">Disco says:</div><div class="disco-modal-msg" id="discoModalMsg"></div><div class="disco-modal-btns" id="discoModalBtns"></div></div></div>
<script>
function discoAlert(msg,cb){var o=document.getElementById('discoModalOverlay'),m=document.getElementById('discoModalMsg'),b=document.getElementById('discoModalBtns');m.textContent=typeof msg==='string'?msg:String(msg);b.innerHTML='<button class="disco-btn-primary" onclick="discoCloseModal(\'ok\')">OK</button>';o.classList.add('active');window._discoCb=cb||null;window._discoOk=null;window._discoCancel=null;}
function discoConfirm(msg,onOk,onCancel){var o=document.getElementById('discoModalOverlay'),m=document.getElementById('discoModalMsg'),b=document.getElementById('discoModalBtns');m.textContent=typeof msg==='string'?msg:String(msg);b.innerHTML='<button class="disco-btn-secondary" onclick="discoCloseModal(\'cancel\')">Cancel</button><button class="disco-btn-primary" onclick="discoCloseModal(\'ok\')">OK</button>';o.classList.add('active');window._discoOk=onOk||null;window._discoCancel=onCancel||null;window._discoCb=null;}
function discoStackSend(){var o=document.getElementById('discoModalOverlay'),m=document.getElementById('discoModalMsg'),b=document.getElementById('discoModalBtns');m.textContent='Sent to Stack Builder!';b.innerHTML='<button class="disco-btn-secondary" onclick="discoCloseModal(\'cancel\')">Close</button><button class="disco-btn-primary" onclick="discoCloseModal(\'ok\')">Open Stack Builder now</button>';o.classList.add('active');window._discoOk=function(){window.location.href='stack-builder-clean.html';};window._discoCancel=null;window._discoCb=null;}
function discoCloseModal(action){document.getElementById('discoModalOverlay').classList.remove('active');if(action==='ok'&&window._discoOk){var f=window._discoOk;window._discoOk=null;f();}else if(action==='cancel'&&window._discoCancel){var f=window._discoCancel;window._discoCancel=null;f();}else if(action==='ok'&&window._discoCb){var f=window._discoCb;window._discoCb=null;f();}}
</script>
</body>
</html>
