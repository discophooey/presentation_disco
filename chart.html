<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scrolltastic Chart</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #111; color: #fff; }

/* Grid Layout */
.app { display: grid; grid-template-columns: 400px 1fr; height: calc(100vh - 45px); margin-top: 45px; }
.controls { background: #111; padding: 20px; overflow-y: auto; border-right: 1px solid #222; }

/* Collapsible Sections */
.section { margin-bottom: 16px; background: #1a1a1a; border-radius: 8px; overflow: hidden; }
.section-header { padding: 12px 16px; background: #222; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 500; }
.section-header:hover { background: #2a2a2a; }
.section-content { padding: 16px; display: none; }
.section.open .section-content { display: block; }
.section-toggle { transition: transform 0.2s; }
.section.open .section-toggle { transform: rotate(180deg); }

/* Form Elements */
label { display: block; margin-bottom: 6px; font-size: 12px; color: #888; }
input[type="text"], input[type="number"], select, textarea { width: 100%; padding: 8px 12px; background: #222; border: 1px solid #333; border-radius: 6px; color: #fff; font-size: 13px; margin-bottom: 12px; }
textarea { min-height: 60px; resize: vertical; }
input[type="color"] { width: 50px; height: 32px; padding: 2px; background: #222; border: 1px solid #333; border-radius: 4px; cursor: pointer; }
input[type="range"] { width: 100%; margin: 8px 0; }

.row { display: flex; gap: 10px; align-items: center; margin-bottom: 12px; }
.row input[type="number"] { width: 70px; margin-bottom: 0; }
.row input[type="range"] { flex: 1; margin: 0; }

/* Toggle Buttons */
.toggle-group { display: flex; gap: 8px; margin-bottom: 12px; }
.toggle-btn { flex: 1; padding: 8px 12px; background: #222; border: 1px solid #333; border-radius: 6px; color: #888; cursor: pointer; font-size: 12px; text-align: center; transition: all 0.2s; }
.toggle-btn:hover { background: #2a2a2a; }
.toggle-btn.active { background: #4a9eff; border-color: #4a9eff; color: #fff; }

/* Data List */
.data-list { max-height: 240px; overflow-y: auto; }
.data-entry { background: #222; padding: 10px; border-radius: 6px; margin-bottom: 8px; }
.data-entry-row { display: flex; gap: 8px; align-items: center; }
.data-entry input[type="text"] { flex: 2; margin-bottom: 0; }
.data-entry input[type="number"] { width: 70px; margin-bottom: 0; }
.data-entry input[type="color"] { width: 36px; height: 30px; }
.data-entry .remove { width: 30px; height: 30px; background: #e74c3c; border: none; border-radius: 4px; color: #fff; cursor: pointer; font-size: 16px; }
.data-entry .remove:hover { background: #c0392b; }

/* Buttons */
.btn { padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s; }
.btn-primary { background: #4a9eff; color: #fff; width: 100%; margin-bottom: 8px; }
.btn-primary:hover { background: #3a8eef; }
.btn-secondary { background: #333; color: #fff; }
.btn-secondary:hover { background: #444; }
.btn-danger { background: #e74c3c; color: #fff; }
.btn-danger:hover { background: #c0392b; }
.btn-add { background: #2a2a2a; color: #4a9eff; border: 1px dashed #4a9eff; width: 100%; margin-top: 8px; }
.btn-add:hover { background: #333; }

/* Preview Area */
.preview-area { background: #000; display: flex; flex-direction: column; overflow: hidden; }
.preview-header { padding: 10px 16px; background: #111; border-bottom: 1px solid #222; display: flex; justify-content: space-between; font-size: 11px; color: #666; }
.preview-scroll { flex: 1; overflow-y: auto; }
.preview-container { position: relative; }
.preview-stage { position: sticky; top: 0; height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; }

/* Chart Container */
.chart-wrap { padding: 30px; border-radius: 12px; display: flex; flex-direction: column; align-items: center; transition: all 0.3s ease; }
.chart-wrap.sizing-fit { width: 90%; max-width: 90vw; height: auto; max-height: 85vh; }
.chart-wrap.sizing-cover { width: 100%; height: 100vh; justify-content: center; border-radius: 0; }
.chart-wrap.sizing-fill { width: 100%; height: 100%; justify-content: center; border-radius: 0; }
.chart-title { font-size: 1.5rem; margin-bottom: 20px; text-align: center; color: #fff; font-weight: bold; }

#chartContent { width: 100%; }

/* Bar Chart */
.bar-chart { width: 100%; display: flex; flex-direction: column; gap: 15px; }
.bar-chart.vertical { flex-direction: row; align-items: flex-end; justify-content: center; height: 300px; gap: 20px; }
.bar-item { display: flex; align-items: center; gap: 10px; }
.bar-item.vertical { flex-direction: column-reverse; height: 100%; }
.bar-label { min-width: 100px; font-size: 0.9rem; color: #ccc; }
.bar-item.vertical .bar-label { min-width: auto; text-align: center; }
.bar-track { flex: 1; height: 30px; background: #333; border-radius: 4px; overflow: hidden; }
.bar-item.vertical .bar-track { width: 50px; height: 100%; flex: none; display: flex; align-items: flex-end; }
.bar-fill { height: 100%; width: 0; border-radius: 4px; transition: width 0.05s linear; }
.bar-item.vertical .bar-fill { width: 100%; height: 0; transition: height 0.05s linear; flex-shrink: 0; }
.bar-value { min-width: 50px; font-size: 0.9rem; color: #fff; font-weight: bold; opacity: 0; transition: opacity 0.3s; }
.bar-item.vertical .bar-value { min-width: auto; }

/* Pie Chart */
.pie-chart { position: relative; width: 300px; height: 300px; }
.pie-chart svg { width: 100%; height: 100%; transform: rotate(-90deg); }
.pie-segment { transition: stroke-dasharray 0.05s linear; }
.pie-center-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; font-size: 1.2rem; font-weight: bold; color: #fff; }
.pie-legend { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; justify-content: center; }
.legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: #fff; }
.legend-color { width: 16px; height: 16px; border-radius: 3px; }

/* Caption & Overlay */
.preview-caption { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); width: 85%; max-width: 700px; padding: 12px 16px; border-radius: 8px; font-size: 13px; line-height: 1.5; color: #e0e0e0; text-align: center; opacity: 0; transition: opacity 0.4s; z-index: 100; }
.preview-caption.on { opacity: 1; }
.preview-caption .caption-credit { color: #999; font-size: 11px; font-style: italic; margin-top: 4px; }
.text-overlay { position: absolute; padding: 12px 20px; border-radius: 4px; transition: opacity 0.4s; z-index: 50; max-width: 90%; box-sizing: border-box; white-space: pre-line; }

/* Modal */
.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; }
.modal.active { display: flex; }
.modal-content { background: #111; border-radius: 12px; padding: 24px; width: 90%; max-width: 800px; max-height: 85vh; overflow: auto; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.modal-close { background: none; border: none; color: #888; font-size: 24px; cursor: pointer; }
textarea#exportCode { width: 100%; height: 300px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 12px; color: #4a9eff; font-family: monospace; font-size: 12px; resize: vertical; }
</style>
</head>
<body>
<div id="disco-nav" style="position:fixed;top:0;left:0;right:0;z-index:99999;background:#111;border-bottom:1px solid #2a2a2a;display:flex;overflow-x:auto;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;">
<a href="index.html" style="padding:8px 12px;color:#4a9eff;text-decoration:none;font-size:12px;font-weight:600;white-space:nowrap;">‚Üê Hub</a>
<a href="before-after.html" data-module="before-after" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Before/After<span class="dot"></span></a>
<a href="card-stack.html" data-module="card-stack" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Card Stack<span class="dot"></span></a>
<a href="chart.html" data-module="chart" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Chart<span class="dot"></span></a>
<a href="collage.html" data-module="collage" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Collage<span class="dot"></span></a>
<a href="doc-module.html" data-module="doc-module" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Doc Module<span class="dot"></span></a>
<a href="gallery.html" data-module="gallery" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Gallery<span class="dot"></span></a>
<a href="globe.html" data-module="globe" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Globe<span class="dot"></span></a>
<a href="hotspots.html" data-module="hotspots" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Hotspots<span class="dot"></span></a>
<a href="layers.html" data-module="layers" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Layers<span class="dot"></span></a>
<a href="matte.html" data-module="matte" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Matte<span class="dot"></span></a>
<a href="pull-quote.html" data-module="pull-quote" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Pull Quote<span class="dot"></span></a>
<a href="single-image.html" data-module="single-image" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Single Image<span class="dot"></span></a>
<a href="stat-counter.html" data-module="stat-counter" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Stat Counter<span class="dot"></span></a>
<a href="timeline.html" data-module="timeline" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Timeline<span class="dot"></span></a>
<a href="video.html" data-module="video" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Video<span class="dot"></span></a>
<a href="zoom-detail.html" data-module="zoom-detail" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Zoom Detail<span class="dot"></span></a>
<a href="text-scroll.html" data-module="text-scroll" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Text Scroll<span class="dot"></span></a>
<a href="chapter-marker.html" data-module="chapter-marker" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Chapter Marker<span class="dot"></span></a>
<a href="key-facts.html" data-module="key-facts" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Key Facts<span class="dot"></span></a>
<a href="body-module.html" data-module="body-module" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;display:flex;align-items:center;gap:4px;">Body Module<span class="dot"></span></a>
<a href="stack-builder-clean.html" style="padding:8px 10px;color:#888;text-decoration:none;font-size:10px;white-space:nowrap;">Stack Builder</a>
</div>
<style>
#disco-nav a:hover{color:#fff!important;background:#1a1a1a;}
#disco-nav .dot{width:6px;height:6px;border-radius:50%;display:none;}
#disco-nav .dot.orange{display:inline-block;background:#f90;}
#disco-nav .dot.green{display:inline-block;background:#4a4;}
</style>
<script>
(function(){
  document.querySelectorAll('#disco-nav a[data-module]').forEach(function(a){
    var mod = a.getAttribute('data-module');
    var key = 'disco_' + mod;
    var dot = a.querySelector('.dot');
    if(!dot) return;
    var hasContent = localStorage.getItem(key);
    var fromPlanner = localStorage.getItem(key + '_from_planner');
    if(hasContent){
      if(fromPlanner === 'true'){
        dot.className = 'dot orange';
      } else {
        dot.className = 'dot green';
      }
    }
  });
  var path = location.pathname.split('/').pop() || 'index.html';
  document.querySelectorAll('#disco-nav a').forEach(function(a){
    if(a.getAttribute('href') === path){
      a.style.color = '#4a9eff';
      a.style.borderBottom = '2px solid #4a9eff';
    }
  });
})();
</script>

<!-- Navigation highlight -->


<!-- Persistence for chart -->
<script>
(function() {
    var KEY = 'disco_chart';
    
    function saveState() {
        var state = { inputs: {} };
        
        state.data = config.data;
        state.chartType = config.chartType;
        state.orientation = config.orientation;
        state.pieStyle = config.pieStyle;
        state.stagger = config.stagger;
        state.sizing = config.sizing;
        
        document.querySelectorAll('input[id], select[id], textarea[id]').forEach(function(el) {
            if (el.type === 'checkbox') state.inputs[el.id] = el.checked;
            else if (el.type === 'file') return;
            else state.inputs[el.id] = el.value;
        });
        try { localStorage.setItem(KEY, JSON.stringify(state)); localStorage.removeItem(KEY + '_from_planner'); } catch(e) {}
    }
    
    function loadState() {
        try {
            var saved = localStorage.getItem(KEY);
            if (!saved) return;
            var state = JSON.parse(saved);
            
            // Restore data array
            if (state.data) config.data = state.data;
            
            // Restore toggle states directly to config
            if (state.chartType) config.chartType = state.chartType;
            if (state.orientation) config.orientation = state.orientation;
            if (state.pieStyle) config.pieStyle = state.pieStyle;
            if (typeof state.stagger !== 'undefined') config.stagger = state.stagger;
            if (state.sizing) config.sizing = state.sizing;
            
            // Restore input values
            Object.keys(state.inputs || {}).forEach(function(id) {
                var el = document.getElementById(id);
                if (el) {
                    if (el.type === 'checkbox') el.checked = state.inputs[id];
                    else if (el.type === 'file') return;
                    else el.value = state.inputs[id];
                    var valEl = document.getElementById(id + 'Val');
                    if (valEl && el.type === 'range') valEl.textContent = el.value + (id.toLowerCase().includes('offset') ? 'px' : (id.toLowerCase().includes('size') ? 'px' : (id.toLowerCase().includes('scale') || id.toLowerCase().includes('duration') ? '%' : '')));
                }
            });
            
            // Update toggle button UI
            document.querySelectorAll('[data-type]').forEach(function(b) { b.classList.toggle('active', b.dataset.type === config.chartType); });
            document.querySelectorAll('[data-orient]').forEach(function(b) { b.classList.toggle('active', b.dataset.orient === config.orientation); });
            document.querySelectorAll('[data-pie]').forEach(function(b) { b.classList.toggle('active', b.dataset.pie === config.pieStyle); });
            document.querySelectorAll('[data-stagger]').forEach(function(b) { b.classList.toggle('active', b.dataset.stagger === String(config.stagger)); });
            document.querySelectorAll('[data-sizing]').forEach(function(b) { b.classList.toggle('active', b.dataset.sizing === config.sizing); });
            
            // Show/hide options
            document.getElementById('bar-options').style.display = config.chartType === 'bar' ? 'block' : 'none';
            document.getElementById('pie-options').style.display = config.chartType === 'pie' ? 'block' : 'none';
            
            renderDataList();
            updatePreviewHeight();
            updatePreview();
        } catch(e) { console.warn('Load state error:', e); }
    }
    
    window.resetModule = function() {
        if (confirm('Reset all settings to defaults?')) {
            localStorage.removeItem(KEY);
            location.reload();
        }
    };
    
    // Wrap data functions to trigger save
    var _orig_addDataEntry = window.addDataEntry;
    window.addDataEntry = function() { _orig_addDataEntry.apply(this, arguments); saveState(); };
    var _orig_removeDataEntry = window.removeDataEntry;
    window.removeDataEntry = function() { _orig_removeDataEntry.apply(this, arguments); saveState(); };
    var _orig_updateDataEntry = window.updateDataEntry;
    window.updateDataEntry = function() { _orig_updateDataEntry.apply(this, arguments); saveState(); };
    
    // Wrap toggle functions to trigger save (onclick doesn't fire change/input events)
    var _orig_setChartType = window.setChartType;
    window.setChartType = function() { _orig_setChartType.apply(this, arguments); saveState(); };
    var _orig_setOrientation = window.setOrientation;
    window.setOrientation = function() { _orig_setOrientation.apply(this, arguments); saveState(); };
    var _orig_setPieStyle = window.setPieStyle;
    window.setPieStyle = function() { _orig_setPieStyle.apply(this, arguments); saveState(); };
    var _orig_setStagger = window.setStagger;
    window.setStagger = function() { _orig_setStagger.apply(this, arguments); saveState(); };
    var _orig_setSizing = window.setSizing;
    window.setSizing = function() { _orig_setSizing.apply(this, arguments); saveState(); };
    
    document.addEventListener('change', saveState);
    document.addEventListener('input', saveState);
    
    setTimeout(loadState, 150);
})();
</script>
</body>
</html>
